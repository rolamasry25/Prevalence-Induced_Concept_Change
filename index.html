<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ethical Evaluation Study</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="dataset.js"></script>
  <!-- Firebase SDK -->
  <script src="/__/firebase/8.10.1/firebase-app.js"></script>
  <script src="/__/firebase/8.10.1/firebase-firestore.js"></script>
  <script src="/__/firebase/init.js"></script>
  <style>
    :root { --brand:#0d6efd; --ok:#198754; --bg:#f9fafc; }
    * { box-sizing:border-box; }
    body { margin:0; font-family:'Segoe UI',system-ui,sans-serif; background:var(--bg); color:#333; }
    nav { background:var(--brand); color:#fff; padding:1rem 2rem; display:flex; justify-content:space-between; align-items:center; font-weight:600; position:sticky; top:0; z-index:1000; }
    nav a { color:#fff; margin-left:1rem; text-decoration:none; cursor:pointer; font-weight:500; }
    nav a:hover { text-decoration:underline; }
    main { display:flex; flex-direction:column; align-items:center; padding:2rem 1rem; }
    .card { background:#fff; border-radius:12px; padding:1.25rem 1.5rem; box-shadow:0 4px 14px rgba(0,0,0,.1); width:100%; max-width:960px; }
    .dashboard-metrics { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:16px; margin:1rem 0 1.25rem; }
    .metric { background:#fff; border-radius:10px; padding:1rem; box-shadow:0 2px 10px rgba(0,0,0,.08); text-align:center; }
    .metric h4 { margin:.25rem 0 0; font-weight:600; font-size:.95rem; color:#555; }
    .metric h3 { margin:.25rem 0 .1rem; font-size:1.25rem; }
    .primary-btn { padding:10px 18px; background:var(--ok); color:#fff; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
    .primary-btn:active { transform:translateY(1px); }
    .flex { display:flex; gap:20px; justify-content:center; align-items:center; flex-wrap:wrap; }
    .hidden { display:none; }
    .text-box { width:100%; min-height:150px; margin:24px auto 18px; border-radius:8px; border:1px solid rgba(0,0,0,.1); padding:1rem; font-size:1.1rem; line-height:1.6; }
    .rating-scale { display:flex; justify-content:center; gap:10px; margin-top:1rem; }
    .rating-btn { padding:10px 20px; border:1px solid #ccc; border-radius:8px; cursor:pointer; background:#fff; }
    .rating-btn:hover { background:#f0f0f0; }
    .breakdown { display:grid; grid-template-columns:repeat(2,minmax(220px,1fr)); gap:18px; }
    @media (max-width:560px){ .breakdown{ grid-template-columns:1fr; } }
    canvas { margin-top:1.25rem; max-width:100%; }
    #lineChart, #rtChart { pointer-events:none; }
    .muted { color:#666; font-size:.95rem; }
    #admin-table { width:100%; border-collapse:collapse; margin-top:1rem; }
    #admin-table th, #admin-table td { border:1px solid #ddd; padding:8px; text-align:left; }
    #admin-table th { background-color:#f2f2f2; }
  </style>
</head>
<body>
  <nav>
    <span class="logo">üî¨ Ethical Evaluation Study</span>
    <div>
      <a onclick="showExperiment()">Experiment</a>
      <a onclick="showDashboard()">Dashboard</a>
      <a onclick="showAdmin()">Admin</a>
    </div>
  </nav>
<!-- Consent -->
<div id="consent" class="card">
  <h2>Consent Form</h2>
  <p class="muted">
    You are invited to take part in a short study on ethical evaluations.
    Your participation is voluntary and anonymous. You may stop at any time.
    No personal information will be collected.
  </p>
  <ul style="margin-left:1.25rem">
    <li>You will be shown 76 short texts to evaluate.</li>
    <li>No identifying data stored</li>
    <li>Press ‚ÄúI Agree‚Äù to begin</li>
  </ul>
  <div class="flex" style="margin-top:1rem">
    <button class="primary-btn" onclick="startExperiment()">I Agree & Start</button>
  </div>
</div>


<main>
<!-- Consent (new) -->
<div id="consent" class="card">
  <h2>Consent Form</h2>
  <p class="muted">
    You are invited to take part in a short study on ethical evaluations.
    Participation is voluntary and anonymous. You may stop at any time.
  </p>
  <ul style="margin-left:1.25rem">
    <li>Approx. duration: 8‚Äì10 minutes</li>
    <li>No identifying data stored</li>
    <li>Press ‚ÄúI Agree‚Äù to begin</li>
  </ul>
  <div class="flex" style="margin-top:1rem">
    <button class="primary-btn" onclick="startExperiment()">I Agree & Start</button>
  </div>
</div>

<!-- Experiment (now hidden initially; no start button) -->
<div id="experiment" class="card hidden"></div>

<!-- Debrief (new) -->
<div id="debrief" class="card hidden">
  <h2>Debrief</h2>
  <p class="muted">
    Thanks! This study examines how judgments shift when the prevalence of
    unethical examples decreases (prevalence-induced concept change).
  </p>
  <div class="flex" style="margin-top:1rem">
    <button class="primary-btn" onclick="showDashboard()">View Dashboard</button>
  </div>
</div>


  
  

    <!-- Personal Summary -->
    <div id="personal-summary" class="card hidden">
      <h2>Your Results</h2>
      <div class="dashboard-metrics">
        <div class="metric">
          <h4>Your Average Rating</h4>
          <h3 id="personal-avg"></h3>
        </div>
        <div class="metric">
          <h4>Global Average Rating</h4>
          <h3 id="global-avg"></h3>
        </div>
      </div>
      <div class="metric">
        <h4>Your Response Distribution</h4>
        <p id="personal-dist"></p>
      </div>
      <div class="metric" style="margin-top: 1rem;">
          <h4>You vs. Others</h4>
          <p id="group-comparison"></p>
      </div>
      <div class="flex" style="margin-top: 1.5rem;">
        <button class="primary-btn" onclick="startExperiment()">Start New Experiment</button>
        <button class="primary-btn" onclick="showDashboard()">View Global Dashboard</button>
      </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="card hidden">
      <h2>Dashboard</h2>
      <div class="dashboard-metrics" id="metrics"></div>
      <canvas id="lineChart" height="250"></canvas>

      <h2 style="margin-top:1.25rem;">Response Distribution</h2>
      <div class="metric">
        <p id="response_dist"></p>
      </div>
      
      <h2 style="margin-top:1.25rem;">Extreme Texts</h2>
      <div class="dashboard-metrics">
          <div class="metric">
              <h4>Most Ethical Text</h4>
              <p id="most-ethical-text" class="text-box" style="min-height: 80px; font-size: 0.9rem;"></p>
              <h3 id="most-ethical-score"></h3>
          </div>
          <div class="metric">
              <h4>Least Ethical Text</h4>
              <p id="least-ethical-text" class="text-box" style="min-height: 80px; font-size: 0.9rem;"></p>
              <h3 id="least-ethical-score"></h3>
          </div>
      </div>

      <h2 style="margin-top:1.25rem;">RT Distribution</h2>
      <div class="metric">
          <canvas id="rtChart" height="250"></canvas>
          <h4 style="margin-top:1rem;">Trimmed Mean RT</h4>
          <h3 id="trimmed-mean-rt"></h3>
      </div>

      <h2 style="margin-top:1.25rem;">Per-Category Stats</h2>
      <div id="category-stats" class="dashboard-metrics"></div>

      <h2 style="margin-top:1.25rem;">Drift Alert</h2>
      <div id="drift-alert" class="metric"></div>
    </div>

    <!-- Admin -->
    <div id="admin" class="card hidden">
        <h2>Admin View</h2>
        <table id="admin-table">
            <thead>
                <tr>
                    <th>Run ID</th>
                    <th>Timestamp</th>
                    <th>Quality Flags</th>
                </tr>
            </thead>
            <tbody id="admin-table-body"></tbody>
        </table>
    </div>
  </main>

  <script>
    // Initialize Firebase
    const db = firebase.firestore();

    let trialIndex = 0;
    let responses  = [];
    let stimuli    = [];
    let dashboardChart = null;
    let rtChart = null;
    let trialStartTime = 0;
    let blurCount = 0;
    let networkStatusChanges = 0;

    window.addEventListener('blur', () => blurCount++);
    window.addEventListener('online', () => networkStatusChanges++);
    window.addEventListener('offline', () => networkStatusChanges++);

    const STORAGE_KEY = "ethical_study_progress";

    function saveProgress(){
      const data = { trialIndex, responses };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));


    function loadProgress(){
      try {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
        if(data && Array.isArray(data.responses)){
          trialIndex = data.trialIndex || 0;
          responses  = data.responses;
          return true;
    
   catch(e){ console.warn("No saved progress"); }
      return false;


    function clearProgress(){ localStorage.removeItem(STORAGE_KEY); }

    function showExperiment(){
      document.getElementById('experiment').classList.remove('hidden');
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('personal-summary').classList.add('hidden');
      document.getElementById('admin').classList.add('hidden');

    function showDashboard(){
      document.getElementById('dashboard').classList.remove('hidden');
      document.getElementById('experiment').classList.add('hidden');
      document.getElementById('personal-summary').classList.add('hidden');
      document.getElementById('admin').classList.add('hidden');
      refreshDashboard();

    function showAdmin(){
      document.getElementById('admin').classList.remove('hidden');
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('experiment').classList.add('hidden');
      document.getElementById('personal-summary').classList.add('hidden');
      renderAdminView();


    function shuffle(arr){
      const a=[...arr]; for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a;


    function startExperiment(){
  document.getElementById('consent').classList.add('hidden');
  document.getElementById('experiment').classList.remove('hidden');

  // remove the old "Loading..." line if you had it
  // document.getElementById('experiment').innerHTML = '<h2>Loading‚Ä¶</h2>';

  trialIndex = 0;
  responses  = [];
  stimuli    = shuffle(window.ethicalTexts).slice(0, 76).map((t,i)=>({ text:t, seq:i+1 }));

  // resume support (if you added it):
  if(loadProgress()){
    if(confirm(`You stopped at trial ${trialIndex+1}. Resume?`)){
      renderTrial(); return;
 else clearProgress();
  }

  renderTrial();



    function renderTrial(){
      trialStartTime = Date.now();
      const tr = stimuli[trialIndex];
      let ratingButtons = '';
      for (let i = 1; i <= 7; i++) {
        ratingButtons += `<button class="rating-btn" onclick="recordResponse(${i})">${i}</button>`;
  
      document.getElementById('experiment').innerHTML = `
        <div style="text-align:center">
          <div class="text-box">${tr.text}</div>
          <p class="muted">1 (Very Unethical) - 7 (Very Ethical)</p>
          <div class="rating-scale">
            ${ratingButtons}
          </div>
          <p class="muted" style="margin-top:.9rem;">
            Trial ${trialIndex + 1} / ${stimuli.length}
          </p>
        </div>`;


    function recordResponse(response){
      const rt = Date.now() - trialStartTime;
      const tr = stimuli[trialIndex];
      responses.push({ ...tr, rating: response, rt });
      trialIndex++;
      if (trialIndex < stimuli.length) {
        renderTrial();
   else {
        finishRun();
  

    document.addEventListener('keydown', (e)=>{
  const exp = document.getElementById('experiment');
  if (!exp || exp.classList.contains('hidden')) return;
  const n = parseInt(e.key, 10);
  if (n >= 1 && n <= 7) recordResponse(n);
});

    function makeRunId(){ return `run_${Date.now()}_${Math.random().toString(36).slice(2,8)}`; }

    async function saveRunToCloud(run){
        try {
            await db.collection("runs").doc(run.run_id).set(run);
            console.log("Run saved to Firestore");
     catch (error) {
            console.error("Error saving run to Firestore: ", error);
            alert("Could not sync results to Firebase. Please check your internet or Firebase setup.");
    


    async function finishRun(){
  clearProgress?.();
  const run = { run_id: makeRunId(), ts: Date.now(), trials: responses };
  document.getElementById('experiment').classList.add('hidden');
  document.getElementById('debrief').classList.remove('hidden');
}

    
    async function showPersonalSummary(run) {
        document.getElementById('experiment').classList.add('hidden');
        document.getElementById('personal-summary').classList.remove('hidden');

        // Calculate personal stats
        const personalTotal = run.trials.reduce((sum, tr) => sum + tr.rating, 0);
        const personalAvg = (personalTotal / run.trials.length); // Keep as float for comparison
        const personalDist = Array(7).fill(0);
        run.trials.forEach(tr => { personalDist[tr.rating - 1]++; });

        document.getElementById('personal-avg').textContent = personalAvg.toFixed(2);
        document.getElementById('personal-dist').innerHTML = personalDist.map((count, i) => `<b>Rating ${i+1}:</b> ${count}`).join(', ');

        // Calculate global stats
        const snapshot = await db.collection("runs").get();
        const allRuns = snapshot.docs.map(doc => doc.data());
        const aggr = aggregate(allRuns);
        const globalAvg = (aggr.totalTrials > 0) ? (aggr.distribution.reduce((sum, count, i) => sum + (count * (i + 1)), 0) / aggr.totalTrials) : 0;
        document.getElementById('global-avg').textContent = globalAvg > 0 ? globalAvg.toFixed(2) : "N/A";

        // Group comparison
        const runAvgs = allRuns.map(r => {
            if (!r.trials || r.trials.length === 0) return 0;
            const total = r.trials.reduce((sum, tr) => sum + tr.rating, 0);
            return total / r.trials.length;
    ).filter(avg => avg > 0);

        if (runAvgs.length > 1) {
            const stricterCount = runAvgs.filter(avg => avg < personalAvg).length;
            const percentile = Math.round((stricterCount / runAvgs.length) * 100);
            document.getElementById('group-comparison').textContent = `You were stricter than ${percentile}% of participants.`;
     else {
            document.getElementById('group-comparison').textContent = "Not enough data for a meaningful comparison yet.";
    


    function calculateQualityFlags(trials, blurCount) {
        const flags = [];

        // Duplicate reliability
        const textRatings = {};
        trials.forEach(tr => {
            if (!textRatings[tr.text]) textRatings[tr.text] = [];
            textRatings[tr.text].push(tr.rating);
    );
        const repeatedTexts = Object.values(textRatings).filter(ratings => ratings.length > 1);
        if (repeatedTexts.length > 0) {
            const correlations = repeatedTexts.map(ratings => {
                const mean = ratings.reduce((a, b) => a + b) / ratings.length;
                const diffs = ratings.map(r => r - mean);
                return diffs.every(d => d === 0) ? 1 : 0; // Simplified correlation
        );
            const reliability = correlations.reduce((a, b) => a + b) / correlations.length;
            if (reliability < 0.6) flags.push("low_reliability");
    

        // Catch trials (assuming 3 catch trials)
        const catchTrials = trials.slice(-3);
        const catchCorrect = catchTrials.reduce((acc, tr, i) => {
            const originalTrial = trials.find(t => t.text === tr.text && t.seq !== tr.seq);
            return acc + (originalTrial && originalTrial.rating === tr.rating ? 1 : 0);
    , 0);
        if (catchCorrect < 2) flags.push("failed_catch");

        // Median RT
        const rts = trials.map(tr => tr.rt).sort((a, b) => a - b);
        const mid = Math.floor(rts.length / 2);
        const medianRt = rts.length % 2 !== 0 ? rts[mid] : (rts[mid - 1] + rts[mid]) / 2;
        if (medianRt < 300) flags.push("median_rt_too_low");
        if (medianRt > 10000) flags.push("median_rt_too_high");

        // Blur events
        if (blurCount >= 10) flags.push("excessive_blur");

        return flags;


    function aggregate(runs) {
        const out = {
            totalRuns: runs.length,
            totalTrials: 0,
            distribution: Array(7).fill(0),
            textRatings: {},
            rts: [],
            categoryStats: {
                ethical: { total: 0, count: 0, correct: 0 },
                ambiguous: { total: 0, count: 0, correct: 0 },
                unethical: { total: 0, count: 0, correct: 0 }
        ,
            slopes: []
    ;

        for (const run of runs) {
            if (!run || !run.trials) continue;
            let xSum = 0, ySum = 0, xySum = 0, x2Sum = 0;
            for (let i = 0; i < run.trials.length; i++) {
                const tr = run.trials[i];
                out.totalTrials++;
                const rating = parseInt(tr.rating, 10);
                if (rating >= 1 && rating <= 7) {
                    out.distribution[rating - 1]++;
            
                
                const text = tr.text;
                if (!out.textRatings[text]) {
                    out.textRatings[text] = { total: 0, count: 0 };
            
                out.textRatings[text].total += rating;
                out.textRatings[text].count++;
                out.rts.push(tr.rt);

                if (out.categoryStats[tr.category]) {
                    out.categoryStats[tr.category].total += rating;
                    out.categoryStats[tr.category].count++;
                    if ((tr.category === 'ethical' && rating > 4) || 
                        (tr.category === 'unethical' && rating < 4)) {
                        out.categoryStats[tr.category].correct++;
                
            

                xSum += i;
                ySum += rating;
                xySum += i * rating;
                x2Sum += i * i;
        
            const n = run.trials.length;
            const slope = (n * xySum - xSum * ySum) / (n * x2Sum - xSum * xSum);
            out.slopes.push(slope);
    
        return out;


    function renderMetrics(aggr) {
        const el = document.getElementById('metrics');
        if (!el) return;
        el.innerHTML = `
            <div class="metric"><h4>Total Runs</h4><h3>${aggr.totalRuns}</h3></div>
            <div class="metric"><h4>Total Trials</h4><h3>${aggr.totalTrials}</h3></div>
        `;


    function renderBreakdowns(aggr) {
        const distEl = document.getElementById('response_dist');
        if(distEl) {
            distEl.innerHTML = aggr.distribution.map((count, i) => `<b>Rating ${i+1}:</b> ${count} responses`).join('<br>');
    


    function renderExtremeTexts(aggr) {
        const textAvgs = Object.entries(aggr.textRatings).map(([text, data]) => ({
            text,
            avg: data.total / data.count
    ));

        if (textAvgs.length < 2) return;

        textAvgs.sort((a, b) => b.avg - a.avg);
        
        const mostEthical = textAvgs[0];
        const leastEthical = textAvgs[textAvgs.length - 1];

        document.getElementById('most-ethical-text').textContent = mostEthical.text;
        document.getElementById('most-ethical-score').textContent = `Avg: ${mostEthical.avg.toFixed(2)}`;
        document.getElementById('least-ethical-text').textContent = leastEthical.text;
        document.getElementById('least-ethical-score').textContent = `Avg: ${leastEthical.avg.toFixed(2)}`;


    function renderRtChart(aggr) {
        const ctx = document.getElementById('rtChart')?.getContext('2d');
        if (!ctx) return;

        const rtData = aggr.rts.filter(rt => rt > 150);
        const mean = rtData.reduce((a, b) => a + b, 0) / rtData.length;
        const stdDev = Math.sqrt(rtData.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b, 0) / rtData.length);
        const trimmedRts = rtData.filter(rt => Math.abs(rt - mean) < 3 * stdDev);
        const trimmedMean = trimmedRts.reduce((a, b) => a + b, 0) / trimmedRts.length;
        document.getElementById('trimmed-mean-rt').textContent = `${trimmedMean.toFixed(0)}ms`;

        const histogram = Array(20).fill(0);
        const binSize = 500;
        trimmedRts.forEach(rt => {
            const bin = Math.floor(rt / binSize);
            if (bin < 20) histogram[bin]++;
    );

        const data = {
            labels: histogram.map((_, i) => `${i * binSize}ms`),
            datasets: [{
                label: 'RT Distribution',
                data: histogram,
                backgroundColor: 'rgba(25, 135, 84, 0.5)',
                borderColor: 'rgba(25, 135, 84, 1)',
                borderWidth: 1
        ]
    ;
        const options = {
            scales: { y: { beginAtZero: true } },
            plugins: { legend: { display: false } }
    ;

        if (rtChart) {
            rtChart.data = data;
            rtChart.options = options;
            rtChart.update();
     else {
            rtChart = new Chart(ctx, { type: 'bar', data, options });
    


    function renderCategoryStats(aggr) {
        const statsEl = document.getElementById('category-stats');
        statsEl.innerHTML = '';
        for (const category in aggr.categoryStats) {
            const stats = aggr.categoryStats[category];
            if (stats.count === 0) continue;
            const avgRating = (stats.total / stats.count).toFixed(2);
            const accuracy = (stats.correct / stats.count * 100).toFixed(1);
            const bias = avgRating - 4;

            statsEl.innerHTML += `
                <div class="metric">
                    <h4>${category.charAt(0).toUpperCase() + category.slice(1)}</h4>
                    <p>Avg Rating: ${avgRating}</p>
                    <p>Accuracy: ${accuracy}%</p>
                    <p>Bias: ${bias.toFixed(2)}</p>
                </div>
            `;
    


    function renderDriftAlert(aggr) {
        const driftEl = document.getElementById('drift-alert');
        const significantSlopes = aggr.slopes.filter(slope => Math.abs(slope) > 0.01).length;
        if (significantSlopes > aggr.totalRuns / 2) {
            driftEl.innerHTML = `<h4>Significant Drift Detected</h4><p>More than half of participants show a significant change in ratings over time.</p>`;
            driftEl.style.color = 'red';
     else {
            driftEl.innerHTML = `<h4>No Significant Drift Detected</h4>`;
            driftEl.style.color = 'green';
    


    function renderChart(aggr) {
        const ctx = document.getElementById('lineChart')?.getContext('2d');
        if (!ctx) return;
        const data = {
            labels: ['1', '2', '3', '4', '5', '6', '7'],
            datasets: [{
                label: 'Rating Distribution',
                data: aggr.distribution,
                backgroundColor: 'rgba(0, 123, 255, 0.5)',
                borderColor: 'rgba(0, 123, 255, 1)',
                borderWidth: 1
        ]
    ;
        const options = {
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: 'Number of Responses' }
            ,
                x: {
                    title: { display: true, text: 'Ethical Rating' }
            
        ,
            plugins: {
                legend: { display: false },
                title: { display: true, text: 'Distribution of Ethical Ratings' }
        
    ;
        if (dashboardChart) {
            dashboardChart.data = data;
            dashboardChart.options = options;
            dashboardChart.update();
     else {
            dashboardChart = new Chart(ctx, { type: 'bar', data, options });
    


    async function renderAdminView() {
        const snapshot = await db.collection("runs").get();
        const runs = snapshot.docs.map(doc => doc.data());
        const tableBody = document.getElementById('admin-table-body');
        tableBody.innerHTML = '';

        runs.forEach(run => {
            const row = tableBody.insertRow();
            row.insertCell().textContent = run.run_id;
            row.insertCell().textContent = new Date(run.ts).toLocaleString();
            row.insertCell().textContent = run.qualityFlags.join(', ') || 'None';
    );


    async function refreshDashboard(){
      try {
        const snapshot = await db.collection("runs").get();
        const runs = snapshot.docs.map(doc => doc.data());

        if (!runs.length) showDataNotice('No runs returned from cloud. Check Firestore collection.');
        else hideDataNotice();
        
        const aggr = aggregate(runs);
        renderMetrics(aggr);
        renderBreakdowns(aggr);
        renderChart(aggr);
        renderExtremeTexts(aggr);
        renderRtChart(aggr);
        renderCategoryStats(aggr);
        renderDriftAlert(aggr);
   catch (e) {
        console.error('[dashboard] Cloud fetch failed:', e);
        showDataNotice('Could not load shared data from Firestore. Check your Firebase setup.');
  


    function showDataNotice(msg){
      let el = document.getElementById('dataNotice');
      if (!el) {
        el = document.createElement('div');
        el.id = 'dataNotice';
        el.style.cssText = 'position:fixed;right:12px;bottom:12px;padding:8px 12px;border-radius:8px;font:12px system-ui;background:#fff3cd;border:1px solid #ffe69c;color:#664d03;box-shadow:0 2px 8px rgba(0,0,0,.08);z-index:1001;';
        document.body.appendChild(el);
  
      el.textContent = msg;
      el.style.display = 'block';

    function hideDataNotice(){
      const el = document.getElementById('dataNotice');
      if (el) el.style.display = 'none';


    window.onload = () => { 
        if (window.location.hash === '#admin') {
            showAdmin();
     else if (window.location.hash === '#dashboard') {
            showDashboard();
    
;
    setInterval(() => {
      const isVisible = !document.getElementById('dashboard').classList.contains('hidden');
      if (isVisible) refreshDashboard();
, 15000);

    window.showExperiment  = showExperiment;
    window.showDashboard   = showDashboard;
    window.showAdmin       = showAdmin;
    window.startExperiment = startExperiment;
    window.recordResponse  = recordResponse;
  </script>
</body>
</html>